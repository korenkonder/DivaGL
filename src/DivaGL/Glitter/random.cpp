/*
    by korenkonder
    GitHub/GitLab: korenkonder
*/

#include "glitter.hpp"

namespace Glitter {
    RandomX random_x;

    static const uint32_t x_float_table[] = {
        0x3ED6C16C, 0x3E444444, 0x3EFA4FA5, 0x3ECFA4FA, 0x3F271C72, 0x3F244444,
        0x3F1E93E9, 0x3F016C17, 0x3E527D28, 0x3E777777, 0x3E9DDDDE, 0x3F7D27D2,
        0x3F666666, 0x3EF60B61, 0x3E7A4FA5, 0x3E4CCCCD, 0x3F4E38E4, 0x3F4B60B6,
        0x3E0B60B6, 0x3E360B61, 0x3E666666, 0x3F51C71C, 0x3F47D27D, 0x3F19999A,
        0x3F64FA50, 0x3F355555, 0x3F3A4FA5, 0x3F4FA4FA, 0x3F7F49F5, 0x3EE4FA50,
        0x3DF49F4A, 0x3F177777, 0x3DC16C17, 0x3EDF49F5, 0x3F6B60B6, 0x3ECB60B6,
        0x3F088889, 0x3F4EEEEF, 0x3F638E39, 0x3E749F4A, 0x3F49F49F, 0x3F36C16C,
        0x3D4CCCCD, 0x3E000000, 0x3E5B05B0, 0x3F5BBBBC, 0x3EF49F4A, 0x3E24FA50,
        0x3D088888, 0x3EEC16C1, 0x3E9F49F5, 0x3F58E38E, 0x3F11C71C, 0x3E7D27D2,
        0x3F7E93E9, 0x3ECE38E4, 0x3C638E39, 0x3F7A4FA5, 0x3DCCCCCD, 0x3F0AAAAB,
        0x3F533333, 0x3F416C17, 0x3C360B61, 0x3EB05B06, 0x3F4C16C1, 0x3EE7D27D,
        0x3F488889, 0x3F511111, 0x3F111111, 0x3F0CCCCD, 0x3F160B61, 0x3F1A4FA5,
        0x3F705B06, 0x3F105B06, 0x3DAAAAAB, 0x3EF33333, 0x3F400000, 0x3EAC16C1,
        0x3F5F49F5, 0x3E927D28, 0x3F493E94, 0x3EF05B06, 0x3EAD82D8, 0x3EDB05B0,
        0x3E8CCCCD, 0x3E89F49F, 0x3F45B05B, 0x3F155555, 0x3EFD27D2, 0x3F29F49F,
        0x3F0FA4FA, 0x3F555555, 0x3CB60B61, 0x3E911111, 0x3E93E93F, 0x3ED9999A,
        0x3E96C16C, 0x3F40B60B, 0x3E9B05B0, 0x3EF8E38E, 0x3F711111, 0x3F133333,
        0x3EEEEEEF, 0x3F727D28, 0x3F093E94, 0x3F0B60B6, 0x3EFE93E9, 0x3F6EEEEF,
        0x3F733333, 0x3E416C17, 0x3F071C72, 0x3F09F49F, 0x3F238E39, 0x3E3BBBBC,
        0x3EC00000, 0x3E49F49F, 0x3F360B61, 0x3ECCCCCD, 0x3F305B06, 0x3F67D27D,
        0x3F200000, 0x3EF1C71C, 0x3F4D82D8, 0x3F582D83, 0x3EDDDDDE, 0x3D93E93F,
        0x3F327D28, 0x3ED82D83, 0x3F00B60B, 0x3F25B05B, 0x3F3DDDDE, 0x3EBA4FA5,
        0x3E333333, 0x3E5DDDDE, 0x3EE0B60B, 0x3D8E38E3, 0x3F0E38E4, 0x3E222222,
        0x3D82D82E, 0x3EDC71C7, 0x3F7DDDDE, 0x3EE93E94, 0x3E0E38E4, 0x3EA66666,
        0x3F022222, 0x3E2AAAAB, 0x3E111111, 0x3EC71C72, 0x3CE38E39, 0x3E982D83,
        0x3F288889, 0x3D582D83, 0x3E16C16C, 0x3E471C72, 0x3E800000, 0x3ED3E93F,
        0x3EA93E94, 0x3EA38E39, 0x3F382D83, 0x3F38E38E, 0x3F3BBBBC, 0x3F293E94,
        0x3F3B05B0, 0x3D99999A, 0x3F0D82D8, 0x3E1F49F5, 0x3F4CCCCD, 0x3F22D82E,
        0x3F577777, 0x3E02D82E, 0x3DE38E39, 0x3DD27D28, 0x3EE66666, 0x3F6CCCCD,
        0x3F149F4A, 0x3F44FA50, 0x3F600000, 0x3EC16C17, 0x3F2EEEEF, 0x3EB33333,
        0x3F333333, 0x3F2C16C1, 0x3F5C71C7, 0x3F066666, 0x3F466666, 0x3EB60B61,
        0x3F182D83, 0x3B360B62, 0x3F2AAAAB, 0x3C9F49F4, 0x3F2FA4FA, 0x3F3F49F5,
        0x3DB60B61, 0x3F311111, 0x3F755555, 0x3ED55555, 0x3EC2D82E, 0x3F622222,
        0x3EC5B05B, 0x3F7C71C7, 0x3F13E93F, 0x3F18E38E, 0x3D2AAAAB, 0x3E2D82D8,
        0x3F377777, 0x3F038E39, 0x3F5E93E9, 0x3DC71C72, 0x3F59999A, 0x3F222222,
        0x3DA4FA50, 0x3F53E93F, 0x3F1D27D2, 0x3BB60B62, 0x3EB8E38E, 0x3DBBBBBC,
        0x3F422222, 0x3E582D83, 0x3EAAAAAB, 0x3F644444, 0x3F0C16C1, 0x3D1F49F5,
        0x3DE93E94, 0x3F671C72, 0x3F04FA50, 0x3EE22222, 0x3CFA4FA5, 0x3F31C71C,
        0x3EC44444, 0x3E05B05B, 0x3F2CCCCD, 0x3E9C71C7, 0x3DB05B06, 0x3E99999A,
        0x3E8FA4FA, 0x3EA7D27D, 0x3F5A4FA5, 0x3F000000, 0x3E955555, 0x3E888889,
        0x3F5D27D2, 0x3E871C72, 0x3DEEEEEF, 0x3F2E38E4, 0x3D638E39, 0x3EFBBBBC,
        0x3F24FA50, 0x3F69F49F, 0x3E1C71C7, 0x3EBE93E9, 0x3D6EEEEF, 0x3DFA4FA5,
        0x3E6EEEEF, 0x3F6C16C1, 0x3F6D82D8, 0x3F71C71C, 0x3F505B06, 0x3D416C17,
        0x3DD82D83, 0x3F4AAAAB, 0x3F782D83, 0x3F349F4A, 0x3EB1C71C, 0x3F42D82E,
        0x3EBBBBBC, 0x3F1B05B0, 0x3F1F49F5, 0x3E816C17, 0x3D9F49F5, 0x3EC88889,
        0x3F127D28, 0x3F60B60B, 0x3F07D27D, 0x3E19999A, 0x3E693E94, 0x3EA22222,
        0x3ED27D28, 0x3E27D27D, 0x3F39999A, 0x3EB77777, 0x3E844444, 0x3E8B60B6,
        0x3D7A4FA5, 0x3E4FA4FA, 0x3EAEEEEF, 0x3F6AAAAB, 0x3F05B05B, 0x3F438E39,
        0x3E60B60B, 0x3F56C16C, 0x3EE38E39, 0x3E3E93E9, 0x3F549F4A, 0x3E555555,
        0x3EA0B60B, 0x3F2B60B6, 0x3F7BBBBC, 0x3F33E93F, 0x3EBD27D2, 0x3E71C71C,
        0x3F6FA4FA, 0x3E305B06, 0x3E38E38E, 0x3EED82D8, 0x3F65B05B, 0x3D13E93F,
        0x3F616C17, 0x3F0EEEEF, 0x3F1C71C7, 0x3E13E93F, 0x3DDDDDDE, 0x3F6E38E4,
        0x3F27D27D, 0x3ED11111, 0x3F777777, 0x3EEAAAAB, 0x3F1BBBBC, 0x3F1DDDDE,
        0x3F216C17, 0x3F78E38E, 0x3C888889, 0x3F3C71C7, 0x3F7B05B0, 0x3F3D27D2,
        0x3F79999A, 0x3F688889, 0x3E82D82E, 0x3EF77777, 0x3F2D82D8, 0x3F471C72,
        0x3C088888, 0x3F560B61, 0x3E088889, 0x3CCCCCCD, 0x3F266666, 0x3F20B60B,
        0x3F527D28, 0x3F02D82E, 0x3F760B61, 0x3F044444, 0x3F73E93F, 0x3F749F4A,
        0x3F76C16C, 0x3F693E94, 0x3E85B05B, 0x3F16C16C, 0x3F5B05B0, 0x3E638E39,
        0x3D360B61, 0x3F5DDDDE, 0x3F800000, 0x3F3E93E9, 0x3E6C16C1, 0x3F62D82E,
        0x3E8E38E4, 0x3EB49F4A, 0x3EA4FA50, 0x3D888889, 0x3EC9F49F, 0x3F444444,
        0x00000000,
    };

    static const uint32_t x_int_table[] = {
        0x01663B, 0x0093BA, 0x00B6DF, 0x0055FA, 0x00056F, 0x0171E9,
        0x0178BD, 0x011C5E, 0x00C875, 0x015832, 0x015785, 0x00C379,
        0x0037A2, 0x000FF8, 0x015A7B, 0x000E5C, 0x00AAE9, 0x00FD61,
        0x017CC5, 0x015F51, 0x005FF9, 0x00C80E, 0x0126BB, 0x002AAF,
        0x000819, 0x003108, 0x01558D, 0x017865, 0x008D3E, 0x012244,
        0x018678, 0x00D564, 0x005E24, 0x015636, 0x00A338, 0x0122E0,
        0x01514C, 0x014F2D, 0x0068E0, 0x013B24, 0x00E6D9, 0x011423,
        0x013816, 0x01781F, 0x00EF31, 0x003FAD, 0x00BEC7, 0x007246,
        0x0075B9, 0x006AEE, 0x000F74, 0x01359E, 0x00DC34, 0x004403,
        0x001824, 0x00EBE9, 0x015E3F, 0x00ED52, 0x0126D1, 0x016D82,
        0x0091B7, 0x006BF1, 0x00BFEA, 0x001196, 0x011653, 0x001449,
        0x0141B7, 0x00411C, 0x015AB9, 0x00801A, 0x00A886, 0x006090,
        0x006D66, 0x01158A, 0x009F27, 0x01445E, 0x00A906, 0x00AB11,
        0x00D04E, 0x017DB5, 0x0158C4, 0x016426, 0x006C1E, 0x009A72,
        0x00282E, 0x000FA1, 0x017C80, 0x00C25A, 0x003199, 0x0173A9,
        0x004F33, 0x015650, 0x00490F, 0x007A69, 0x0059BF, 0x016CD1,
        0x0055EB, 0x012437, 0x00844E, 0x0090D4, 0x01556B, 0x00FD65,
        0x00B7CD, 0x001B58, 0x017541, 0x011A31, 0x015541, 0x0127FE,
        0x0145F8, 0x00217F, 0x00455F, 0x00FDD8, 0x01274D, 0x00A8B1,
        0x001FF4, 0x001FB8, 0x004E42, 0x016D7F, 0x005B3C, 0x009095,
        0x00164C, 0x0100CB, 0x0002AB, 0x0142A3, 0x01069B, 0x0006EB,
        0x008435, 0x01515E, 0x0007F2, 0x018338, 0x014AAC, 0x00EE95,
        0x014270, 0x01142A, 0x0096B8, 0x00B296, 0x010F88, 0x004CD4,
        0x006AE6, 0x0171D5, 0x00AD6A, 0x00CCD6, 0x010438, 0x006666,
        0x001999, 0x004F4B, 0x014C6C, 0x007EB4, 0x00E148, 0x013BE6,
        0x000043, 0x016EEE, 0x009CE8, 0x0061EB, 0x00490F, 0x011738,
        0x00C02B, 0x00B9ED, 0x00EE7A, 0x00D519, 0x011F19, 0x0075D6,
        0x000F80, 0x0060D9, 0x004F77, 0x017B63, 0x007703, 0x0098D1,
        0x00C6F4, 0x014926, 0x00E2B6, 0x00BBBF, 0x001F02, 0x00C3AA,
        0x009C82, 0x0100A9, 0x00EA47, 0x0096D8, 0x012610, 0x018129,
        0x012C41, 0x00F131, 0x00F16E, 0x015509, 0x00D544, 0x011686,
        0x012F14, 0x016F80, 0x0012D6, 0x008D8D, 0x006245, 0x0155AF,
        0x007E83, 0x00B8E7, 0x002165, 0x016124, 0x01190D, 0x00D764,
        0x0127F5, 0x00163B, 0x0043C1, 0x010F0C, 0x00C855, 0x002D18,
        0x014DA5, 0x0176B9, 0x0017B8, 0x01351C, 0x011656, 0x00D94F,
        0x00FDAF, 0x015F3B, 0x00B41D, 0x013BAB, 0x0151CB, 0x00D8D3,
        0x00FFF2, 0x003DE4, 0x000D45, 0x0148C2, 0x016F76, 0x01661C,
        0x007CF7, 0x006069, 0x009101, 0x006D63, 0x00A21D, 0x006F29,
        0x00E4D9, 0x00A2EF, 0x010C9B, 0x0172E4, 0x002BB3, 0x016C4E,
        0x00C257, 0x010995, 0x0141F2, 0x013BE8, 0x005100, 0x01459E,
        0x00DE88, 0x00FB44, 0x00F02D, 0x0050CA, 0x004BF9, 0x014505,
        0x00083F, 0x006644, 0x008898, 0x00E94B, 0x005EB3, 0x0094D1,
        0x008948, 0x0180C8, 0x00D50F, 0x01372D, 0x00204E, 0x00D42A,
        0x0062EF, 0x001055, 0x00C41D, 0x0039A3, 0x002732, 0x004493,
        0x01070E, 0x015484, 0x0068F3, 0x0084F1, 0x00A7E4, 0x00ABE7,
        0x015650, 0x0063B1, 0x00A3C2, 0x00B8DD, 0x0128E3, 0x006306,
        0x012526, 0x0104BD, 0x007589, 0x005E02, 0x008BB4, 0x00DDD3,
        0x003A2C, 0x012687, 0x010E85, 0x017A83, 0x00F342, 0x00B1C4,
        0x006B1F, 0x016D1E, 0x00FA31, 0x0039B6, 0x012987, 0x0006B8,
        0x01319A, 0x009296, 0x0152B6, 0x007B87, 0x00E665, 0x012124,
        0x004CF2, 0x0133C8, 0x01838B, 0x009530, 0x017C0A, 0x01196B,
        0x0124EC, 0x01512F, 0x000008, 0x01019B, 0x00CA28, 0x00D76F,
        0x001882, 0x002191, 0x015356, 0x00499B, 0x013138, 0x0170E2,
        0x00F046, 0x01480E, 0x013456, 0x017BCB, 0x003691, 0x0004F3,
        0x00ECAE, 0x004AEA, 0x01460E, 0x0053CA, 0x000D17, 0x011A78,
        0x000869, 0x00C190, 0x0130BB, 0x00FFEF, 0x013B73, 0x0103DB,
        0x00885A, 0x00A503, 0x0038BC, 0x005B4A, 0x0150B5, 0x016CAB,
        0x0167AF, 0x006396, 0x00528E, 0x00156C, 0x016428, 0x00D508,
        0x0178F0, 0x00512B, 0x005CFC, 0x004098, 0x005897, 0x001F27,
        0x0073DA, 0x00F12C, 0x016CBA, 0x007417, 0x009A1C, 0x00D3D0,
        0x000001,
    };

    RandomX::RandomX() {
        value = 0;
        step = 1;
    }

    float_t RandomX::GetFloat(float_t value) {
        float_t val = *(float_t*)&x_float_table[this->value % 0x169];
        this->value += this->step;
        return val * (value + value) - value;
    }

    float_t RandomX::GetFloat(float_t min, float_t max) {
        float_t val = *(float_t*)&x_float_table[value % 0x169];
        value += step;
        return val * (max - min) + min;
    }

    int32_t RandomX::GetInt(int32_t value) {
        int32_t val = x_int_table[this->value % 0x169];
        return val % value;
    }

    int32_t RandomX::GetInt(int32_t min, int32_t max) {
        if (max == min)
            return min;

        int32_t val = x_int_table[value % 0x169];
        value += step;
        return val % (max - min) + min;
    }

    int32_t RandomX::GetValue() {
        return value;
    }

    vec3 RandomX::GetVec3(const vec3& value) {
        vec3 val;
        val.x = *(float_t*)&x_float_table[this->value % 0x169];
        this->value += step;
        val.y = *(float_t*)&x_float_table[this->value % 0x169];
        this->value += step;
        val.z = *(float_t*)&x_float_table[this->value % 0x169];
        this->value += step;
        return val * (value + value) - value;
    }

    void RandomX::Reset() {
        value = 0;
        step = 1;
    }

    void RandomX::SetStep(uint8_t step) {
        this->step = step;
    }

    void RandomX::SetValue(int32_t value) {
        this->value = value;
    }

    void RandomX::StepValue() {
        value += step;
    }

    int32_t RandomX::GetMax() {
        return 0x169;
    }
}
